<?php
namespace App\Http\Controllers\Api;
use App\Http\Controllers\Controller; use App\Models\Chapitre; use Illuminate\Http\Request; use Illuminate\Http\JsonResponse; use Illuminate\Support\Facades\Log;
class ChapitreController extends Controller {
    public function store(Request $request): JsonResponse { $validated = $request->validate(['nom' => 'required|string|max:255', 'matiere_id' => 'required|integer|exists:matieres,id', 'ordre' => 'nullable|integer']); try { $chapitre = Chapitre::create($validated); return response()->json($chapitre, 201); } catch (\Exception $e) { Log::error("Err store Chapitre: ".$e->getMessage()); return response()->json(['error'=>'Err création chapitre.'], 500); } }
    public function show(Chapitre $chapitre): JsonResponse { try { $chapitre->load(['matiere:id,nom', 'lecons']); return response()->json($chapitre); } catch (\Exception $e) { Log::error("Err show Chapitre {$chapitre->id}: ".$e->getMessage()); return response()->json(['error'=>'Err load chapitre.'], 500); } }
    public function update(Request $request, Chapitre $chapitre): JsonResponse { $validated = $request->validate(['nom' => 'required|string|max:255', 'matiere_id' => 'sometimes|required|integer|exists:matieres,id', 'ordre' => 'nullable|integer']); try { $chapitre->update($validated); return response()->json($chapitre); } catch (\Exception $e) { Log::error("Err update Chapitre {$chapitre->id}: ".$e->getMessage()); return response()->json(['error'=>'Err màj chapitre.'], 500); } }
    public function destroy(Chapitre $chapitre): JsonResponse { try { $chapitre->delete(); return response()->json(['message' => 'Chapitre supprimé.'], 200); } catch (\Exception $e) { Log::error("Err destroy Chapitre {$chapitre->id}: ".$e->getMessage()); return response()->json(['error'=>'Err suppression chapitre.'], 500); } }
}